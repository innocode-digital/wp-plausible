!function(p,e,g,v){e.domReady(()=>{const{api:s,charts:n,per_page:e}=p,a={period:"7d",startDate:null,endDate:null,filters:[]},t=new URLSearchParams(window.location.search);if(t.has("period")){var i=(new Date).toISOString().split("T")[0];switch(t.get("period")){case"day":case"7d":case"30d":case"month":case"6mo":case"12mo":a.period=t.get("period");break;case"custom":a.period="custom",a.startDate=t.get("start_date")||i,a.endDate=t.get("end_date")||i;break;default:a.period="custom",a.startDate=t.get("period"),a.endDate=i}}t.has("event:page")&&a.filters.push("event:page=="+t.get("event:page")),["country","entry_page","exit_page","source","utm_medium","utm_source","utm_campaign","utm_term","utm_content","device","browser","os"].forEach(e=>{t.has(e)&&a.filters.push(`visit:${e}==`+t.get(e))}),["device_pixel_ratio","language","ad_blocker"].forEach(e=>{t.has(e)&&a.filters.push(`event:props:${e}==`+t.get(e))});const d=(e=0)=>new Intl.NumberFormat(document.documentElement.lang||"en-US").format(e),c=e=>new Date(e).toLocaleDateString(document.documentElement.lang||"en-US",{month:"short",day:"numeric",year:"numeric"}),l=(e=0)=>{var t=new Date(1e3*e).toISOString();return e<3600?t.substring(14,19):t.substring(11,16)},u=e=>{e=document.getElementById("innstats-widget-"+e).nextElementSibling;e&&e.remove()},m=e=>{[...document.getElementById("innstats-section-"+e).querySelectorAll(".innstats-widget > .inside")].forEach(e=>{var t;e=e,(t=document.createElement("span")).classList.add("spinner"),e.appendChild(t)})};var r=(e,t)=>{const i=document.getElementById("innstats-section-"+e);if(i){const s=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(t(i),s.unobserve(i))})});s.observe(i)}};const o=document.createElement("div");o.classList.add("innstats-widget","innstats-widget_realtime-visitors"),document.getElementById("innstats-header").appendChild(o),s.realtimeVisitors().send().then(e=>{o.innerHTML=`<span class="innstats-realtime-status innstats-realtime-status_online" aria-label="Online"></span> <span id="innstats-realtime-visitors">${e}</span> currently online`,u("misc")}),r("general",()=>{m("general");var e=document.getElementById("innstats-widget-misc");const r=document.createElement("dl"),o=document.createElement("div");r.classList.add("innstats-widget","innstats-widget_aggregate"),o.classList.add("innstats-widget","innstats-widget_top-countries"),e.appendChild(r),e.appendChild(o),s.aggregate().addMetric("pageviews").addMetric("bounce_rate").addMetric("visit_duration").withPreviousPeriod().byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).send().then(a=>{[["visitors","Unique visitors"],["pageviews","Total pageviews"],["visit_duration","Visit duration"],["bounce_rate","Bounce rate"]].forEach(([e,t])=>{var{value:i,change:s}=a[e],n=document.createElement("dt"),t=(n.innerHTML=t,r.appendChild(n),document.createElement("dd")),n=`<span id="innstats-${e}">${("visit_duration"===e?l:d)(i)}</span>`;t.innerHTML=n+("bounce_rate"===e?"%":"")+(s?` <span id="innstats-${e}-change" class="innstats-badge innstats-badge_${s<0?"danger":"success"}">${s}%</span>`:""),r.appendChild(t)}),u("misc")}),s.timeseries().addMetric("pageviews").addMetric("bounce_rate").addMetric("visit_duration").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).send().then(e=>{n.lines(e.map(e=>({...e,timeseries:c(e.date)})),"timeseries",null,["visitors","pageviews"],{visitors:"Unique visitors",pageviews:"Total pageviews"}),n.line(e.map(e=>({...e,y:e.visit_duration,value:l(e.visit_duration),visit_duration:c(e.date)})),"visit_duration","Visit duration",e=>l(e)),n.line(e.map(e=>({...e,y:e.bounce_rate,value:e.bounce_rate+"%",bounce_rate:c(e.date)})),"bounce_rate","Bounce rate",e=>e+"%"),u("timeseries"),u("visit_duration"),u("bounce_rate")}),Promise.all([fetch("https://cdn.jsdelivr.net/npm/visionscarto-world-atlas@0.1.0/world/110m.json").then(e=>e.json()),fetch("https://cdn.jsdelivr.net/npm/i18n-iso-countries@7.5.0/codes.json").then(e=>e.json()),s.breakdownByVisit("country").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(100).send()]).then(([e,a,t])=>{const r=g.topojson.feature(e,e.objects.countries).features.filter(e=>"Antarctica"!==e.properties.name);n.choropleth(r.map(i=>({feature:i,country:i.properties.name,visitors:t.find(t=>i.id===a.find(([e])=>e===t.country)?.[2])?.visitors,code:a.find(([,,e])=>e===i.id)?.[0]})),"country","Countries"),u("country"),o.innerHTML="<h4>Top Countries</h4><ul></ul>",t.slice(0,10).forEach(({country:t,visitors:e})=>{var i=document.createElement("li"),s=String.fromCodePoint(...t.toUpperCase().split("").map(e=>127397+e.charCodeAt(0))),n=r.find(e=>e.id===a.find(([e])=>e===t)?.[2])?.properties.name||t;i.innerHTML=`${s} ${n} <strong>${d(e)}</strong>`,o.querySelector("ul").appendChild(i),u("misc")})})}),r("top_pages",()=>{m("top_pages"),s.breakdownByEvent("page").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e).send().then(e=>{n.horizontalBar(e,"page","Popular"),u("page")});const i={entry_page:"Entry Pages",exit_page:"Exit Pages"};Object.keys(i).forEach(t=>{s.breakdownByVisit(t).byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e).send().then(e=>{n.horizontalBar(e,t,i[t]),u(t)})})}),r("top_sources",()=>{m("top_sources");const i={source:"Popular",utm_medium:"UTM Medium",utm_source:"UTM Source",utm_campaign:"UTM Campaign",utm_term:"UTM Term",utm_content:"UTM Content"};Object.keys(i).forEach(t=>{s.breakdownByVisit(t).byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e+1).send().then(e=>{n.horizontalBar(e.filter(e=>"Direct / None"!==e[t]).slice(0,10),t,i[t]),u(t)})})}),r("devices_and_browsers",()=>{m("devices_and_browsers");const i={device:"Devices",browser:"Browsers",os:"Operating Systems"};Object.keys(i).forEach(t=>{s.breakdownByVisit(t).byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e).send().then(e=>{n.pie(e,t,i[t]),u(t)})}),s.breakdownByProp("language").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e).send().then(e=>{n.pie(e.map(e=>{var{language:t}=e["props"],i=new Intl.DisplayNames([document.documentElement.lang||"en-US"],{type:"language"});return{...e,language:i.of(t)+` (${t})`}}),"language","Languages"),u("language")}),s.breakdownByProp("device_pixel_ratio").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(e).send().then(e=>{e=e.map(e=>({...e,device_pixel_ratio:e.props.device_pixel_ratio})).sort((e,t)=>e.device_pixel_ratio-t.device_pixel_ratio);n.bar(e,"device_pixel_ratio","Retina","Device Pixel Ratio"),u("device_pixel_ratio")}),s.breakdownByProp("ad_blocker").byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).limitResults(2).send().then(e=>{n.bar(e.map(e=>({...e,ad_blocker:"yes"===e.props.ad_blocker?"Yes":"No"})).reverse(),"ad_blocker","Ad Blocker"),u("ad_blocker")})}),v&&v(document).on("heartbeat-send",()=>{"hidden"!==document.visibilityState&&(s.realtimeVisitors().send().then(e=>{document.getElementById("innstats-realtime-visitors").innerHTML=e}),s.aggregate().addMetric("pageviews").addMetric("bounce_rate").addMetric("visit_duration").withPreviousPeriod().byTimePeriod(a.period,a.startDate,a.endDate).useFilters(a.filters).send().then(a=>{Object.keys(a).forEach(e=>{var{value:t,change:i}=a[e],s=document.getElementById("innstats-"+e),n=document.getElementById(`innstats-${e}-change`);s&&(s.innerHTML=("visit_duration"===e?l:d)(t)),i&&n&&(n.innerHTML=(0<i?"+":"")+i+"%",n.classList.remove("innstats-badge_success","innstats-badge_danger"),n.classList.add("innstats-badge_"+(0<i?"success":"danger")))})}))}),document.querySelectorAll(".innstats-filter__button").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.closest("form");t.parentNode.remove(),e.submit()})})})}(window.innstats,window.wp,window.ChartGeo,window.jQuery);